---
title: 给自己看的 crontab 指南
tags: [Linux]
category: Linux
date: 2020-4-29 21:25
---
# 给自己看的 crontab 指南
在 Linux 中，经常需要执行几哈UR恩物，通过 crontab 命令就能指定固定时间或者间隔时间运行命令。

## 计划任务
循环执行的计划任务都由 cron（crond）来控制，这系统服务是默认启动的，不同用户可以使用 crontab 来建立自己的计划任务。

### 限制用户
通过配置文件可以限制使用 crontab 的账号：
- `/etc/cron.allow`，可以使用 crontab 的用户写入文件中，不在文件内不可使用 crontab
- `/etc/cron.deny`，不可使用 crontab 的用户写入文件中，不在文件内则可以使用 crontab

选择其一设置即可，如果用户可以使用 crontab，则可以通过`crontab -e`来配置 cron。

### 命令
crontab 使用方法如下：
```sh
crontab [-u username] [-l|-e|-r]
# -u 命令需要 root 才能使用，指定配置某个用户的 cron
# -l 列出当前的 cron 任务
# -e 编辑当前的 cron 任务
# -r 移除当前的 cron 任务（全部删除）
```

### 时间格式
一般来说 cron 命令都具有留个字段，分别代表：

| 含义   | 分钟     | 小时     | 日期     | 月份     | 周     | 命令      |
|------|--------|--------|--------|--------|-------|---------|
| 数字可用范围 | 0 ~ 59 | 0 ~ 23 | 1 ~ 31 | 1 ~ 12 | 0 ~ 7(0 和 7 都代表星期天) | 具体执行的命令 |

除了数字，还可以使用一些特殊字符：

| 特殊字符 | 含义                                                          |
|------|-------------------------------------------------------------|
| `*`  | 代表任何时刻都接收                                                   |
| `,`  | 代表分隔时段，比如要执行 12:00 和 15:00 的时候，命令为`0 12,15 * * *`           |
| `-`  | 代表一段时间内，比如在 12:00 至 15:00 ，每隔 5 分钟执行一次任务，命令为`5 12-15 * * *` |
| `/`  | `/n`代表间隔 n 个单位，例如每隔两分钟执行一次任务，命令为`8/2 * * * *`               |

以下是一些命令样例：
- 每年的 10 月 9 号 15:00 执行命令：`0 15 9 10 *`
- 每个星期天 15:25 执行命令：`25 15 * * 0`

## 配置文件
cron 的配置文件主要为：
### `/etc/crontab`
```sh
SHELL=/bin/bash
PATH=/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=root

# For details see man 4 crontabs

# Example of job definition:
# .---------------- minute (0 - 59)
# |  .------------- hour (0 - 23)
# |  |  .---------- day of month (1 - 31)
# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...
# |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat
# |  |  |  |  |
# *  *  *  *  * user-name  command to be executed
```
这个文件是一个**纯文本**文件，可以看到大致和`crontab -e`格式稍有区别，实际上`crontab -e`编辑的是`/usr/bin/crontab`的**可执行**文件。

这个文件相比之前的有如下差别：
1. MAILTO ，通过名字就可以看出是邮件，实际上是有错误信息时发送邮件传输给谁的配置
2. PATH，执行文件的查找路径，一般默认就可以了
3. 执行命令在时间后面多了一个用户

### `/etc/cron.d/*`
crond 默认还会执行一个配置文件，就是`cron.d`目录下的内容，这个目录一般是在有了自己的应用的时候，将应用执行的定时命令通过`/etc/crontab`格式放置在该目录下。

### `/etc/cron.hourly...`
还可以看出来，`/etc`目录下还有很多`cron`相关的目录，这些其实就是系统创建的一个快捷方式，
比如`cron.hourly`，你可以直接将命令放置在这个目录下，系统会在每小时执行（执行时机是在每小时的第一分钟开始后的五分钟内），其它文件同理：

- cron.daily
- cron.hourly
- cron.monthly
- cron.weekly


